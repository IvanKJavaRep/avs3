
4-5 БАЛЛОВ

Для своего варианта я выбрал следующую реализацию: чтобы не вводить огромныеданные, я создал массив
длиной 9, чтобы тудаа вводить 9 символов. Такая программа все равно корректно отражает работу с первой
половиной таблицы ASCII.

1. Создаем файл String.c 
В нем написан код с использованием локальных переменных, передачей параметров, поэтому откомментированный
ассемблер будет сразу на 5 баллов.

2. gcc -S -O0 String.c -o String_with_no_description.s
Будет создан ассемблерный файл String_with_no_description.s, откомпилированный без оптимизирующих и отладочных опций 
из-за использования ключа -O0

Создадим файл String_with_description.s - копию String_with_no_description.s, в который будет вносить комментарии
по ассемблеру.

3. gcc -S -O0 -Wall  -fno-asynchronous-unwind-tables -fcf-protection=none String.c -o String_optimized.s
данная команда уберет все макросы .cfi, которые генерируют отладочную информацию.


cat String_optimized.s | awk '/^\t\./ { print $1 }' | sort | uniq > asm_macros.md
Данная команда создаст файл asm_macros.md на основе String_optimized.s, в котором 
будут записаны все используемые макросы. Если выполним то же самое для  файла String_with_no_description.s, то там будут 
макросы .cfi

4. gcc -O0 String_optimized.s -o not_optimized.out 
данная команда создаст исполняемый файл not_optimized.out из ассемблерного файла String_optimized.s
5. gcc -O0 String_with_no_description.s -o final.out 
данная команда создаст исполняемый файл final.out из ассемблерного файла String_with_no_description.s


6. Чтобы запустить файл и протестировать, нужно переместиться в папку с файлом и выполнить команду
./final.out или ./not_optimized.out. Выполним обе команды, чтобы сравнить результаты тестов.

тесты:
1)  asddfgggg
Вывод: 9
2) fffff\tfff
Вывод: 8 (табуляция - неотображаемый символ)
3)
f\nf\nf\nf\nf
Вывод: 5 (4 раза \n - неотображаемые символы)

Вывод: обе программы дают одинаковый и корректный результат на тестах. 
Результаты всех программ на тестах 1-3 приведены на скриншоте normal_assembler.png и optimized.png
Все проведенные модификации сохраняют корректность работы программы.




6 БАЛЛОВ

1. Создадим файл reg.s - копия String_optimized.s, в который будем вносить изменения и комментарии.

2. Сделан рефакторинг программы засчет замещения обращения к стеку, с помощью сохранения нужных значений в регистры процессора, которые 
изменяются только пользователем и не могут быть очищены автоматически.

3. Канарейка оставлена на стеке, а команда leaq	-17(%rbp), %rdx всего лишь высчитывает адрес, а не обращается напрямую к памяти, поэтому
заменять ее на регистры не имеет смысла, так как повышения эффективности тут не получить.
На регистры заменены локальные переменные и работа с элементами массива.


4. также создан файл final_registers.out, который показывает корректную работу программы после внесения всех изменений на тестах 1-3.
Результат тестов показан на скриншоте registers.png

# avs3
